<!DOCTYPE HTML>
<html>
	<head>
		<title>Halcyonic by HTML5 UP</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        {% load static %}
        <link rel="stylesheet" href="{% static 'css/main.css' %}" />

		<style>
			.news-box {
				transition: background-color 0.3s ease, border-radius 0.3s ease; 
			}
			.news-box:hover {
				background-color: #007788; /* 마우스 오버 시 배경색 변경 */
				border-radius: 15px; /* 마우스 오버 시 모서리를 둥글게 */
			}
			.button {
			  display: inline-block;
			  padding: 10px 25px;
			  background-color: #f0f0f0; /* Neutral shade */
			  border: none;
			  border-radius: 20px; /* Rounded corners */
			  box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1); /* Subtle shadow for 3D effect */
			  cursor: pointer;
			  outline: none;
			  transition: all 0.3s ease;
			}
		  
			.button:hover {
			  box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2);
			}
		  
			.button:focus {
			  box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.2);
			}
		  
			.button:active {
			  box-shadow: inset 0px 2px 4px rgba(0, 0, 0, 0.2);
			}
		  
			.button__dots {
			  display: flex;
			  justify-content: center;
			}
		  
			.dot {
			  height: 5px;
			  width: 5px;
			  background-color: #333; /* Dot color */
			  border-radius: 50%;
			  margin: 0 2px;
			}
			.progress-bar {
				width: 100%;
				background-color: #f0f0f0;
				border-radius: 20px; 
				position: relative; 
				overflow: hidden; 
				box-shadow: inset 0px 2px 4px rgba(0, 0, 0, 0.1); 
			}
			
			.progress-bar-value {
				display: block;
				height: 30px;
				background-image: linear-gradient(to right, #99FFFF, #CCFFFF);
				transition: width 0.5s ease;
				border-radius: 20px 0 0 20px; 
			}
			
			.progress-bar-text {
				position: absolute;
				width: 100%;
				text-align: center;
				line-height: 30px; 
				font-weight: bold;
				font-size: 0.8em;
				color: #ffffff;
				top: 0;
			}
		  </style>
	</head>
	<body>
		{% if messages %}
			<script>
				{% for message in messages %}
					alert("{{ message }}");
				{% endfor %}
			</script>
		{% endif %}

		<div id="page-wrapper">
				<section id="header">
					<div class="container">
						<div class="row">
							<div class="col-12">
                                <h1><a href="{% url 'index' %}" id="logo">NEWS RAG</a></h1>
									<nav id="nav">
										<a href="{% url 'index' %}" id="logo">Summary ver.1(T-5)</a>
										<a href="{% url 'index' %}" id="logo">Summary ver.2(Gemma 04.24,,)</a>
										{% comment %} <a href="{% url 'index' %}" id="logo">Summary ver.3</a> {% endcomment %}
									</nav>
							</div>
						</div>
					</div>
					<div id="banner">
						<div class="container">
							<div class="row">
								<div class="col-6 col-12-medium">

										<p>오늘 뉴스 요약</p>
										<a href="{% url 'crawl-news' %}" class="button-large">뉴스 업데이트!</a>

								</div>
								<div class="col-6 col-12-medium imp-medium">

									<p>AI 타임즈 TOP10 기사를 간편하게</p>
										<a href="#" class="bordered-feature-image"><img src="images/banner.jpg" alt="" /></a>

								</div>
							</div>
						</div>
					</div>
				</section>

			<section id="features">
				<div class="container">
					<div class="row">
						{% for news in news_list %}
						<div class="col-md-6 col-12" style="width: 50%;">
							<div class="news-box">
								<li>
									<h1>Rank: {{ news.rank }}</h1>
									<a href="{{ news.url }}">
										<h2>{{ news.title }}</h2>
									</a>
									<p>Published Date: {{ news.published_date }}</p>
									{% if '.gif' in news.photo_url %}
										<p>영상 없음.</p>
									{% elif 'youtube' in news.photo_url %}
										<div>Video: <iframe width="560" height="315" src="{{ news.photo_url }}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
									{% endif %}
									<div id="content-{{ forloop.counter }}" class="news-content" style="display: none;">
										<p>{{ news.content }}</p>
									</div>
									<button onclick="summarizeNews({{ news.id }}); showProgress({{ news.id }});">요약하기</button>
									<div id="progress-{{ news.id }}" class="progress-bar" style="display: none;">
										<div class="progress-bar-value" style="width: 0%;"></div>
										<span class="progress-bar-text">Idle state</span>
									</div>
									<div id="summary-{{ news.id }}" class="news-summary" style="display: none;"></div>
								</li>
							</div>
						</div>
						{% endfor %}
					</div>
				</div>
			</section>

			<script>
				// 요약 내용을 토글하는 기능
				function toggleContent(index) {
					var contentDiv = document.getElementById('content-' + index);
					if (contentDiv.style.display === 'none') {
						contentDiv.style.display = 'block';
					} else {
						contentDiv.style.display = 'none';
					}
				}
				
				// 뉴스 요약을 가져오는 Ajax 함수
				function summarizeNews(newsId) {
					// Fetch API를 사용하여 요약을 서버에 요청
					fetch('/summarize/' + newsId + '/')
					.then(response => response.json())
					.then(data => {
						// 서버로부터 받은 요약 결과를 페이지에 표시
						var summaryDiv = document.getElementById('summary-' + newsId);
						summaryDiv.innerHTML = data.summary; // 서버로부터 받은 요약 내용
						summaryDiv.style.display = 'block';
					})
					.catch(error => {
						console.error('Error:', error);
					});
				}
				function showProgress(newsId) {
					var progressBar = document.getElementById('progress-' + newsId);
					var progressText = progressBar.querySelector('.progress-bar-text');
					progressBar.style.display = 'block';
					var progressValue = progressBar.querySelector('.progress-bar-value');
					progressValue.style.width = '25%'; // 시작할 때 50%로 설정
					progressText.textContent = '처리중...'; // 텍스트 업데이트
				}
				
				function summarizeNews(newsId) {
					var progressBar = document.getElementById('progress-' + newsId);
					var progressValue = progressBar.querySelector('.progress-bar-value');
				
					// Fetch API를 사용하여 요약을 서버에 요청
					fetch('/summarize/' + newsId + '/')
					.then(response => response.json())
					.then(data => {
						// 서버로부터 받은 요약 결과를 페이지에 표시
						var summaryDiv = document.getElementById('summary-' + newsId);
						summaryDiv.innerHTML = data.summary; // 서버로부터 받은 요약 내용
						summaryDiv.style.display = 'block';
				
						// 프로그레스 바 완료
						progressValue.style.width = '100%'; // 요약 완료 시 100%로 설정
						setTimeout(() => {
							progressBar.style.display = 'none'; // 진행 바 숨김
							progressValue.style.width = '0%'; // 다음 사용을 위해 리셋
						}, 1000); // 1초 후에 프로그레스 바 숨김
					})
					.catch(error => {
						console.error('Error:', error);
						progressBar.style.display = 'none'; // 에러 시 프로그레스 바 숨김
					});
				}
				</script>
			
				<section id="footer">
					<div class="container">
						<div class="row">
							<div class="col-8 col-12-medium">
									<section>
										<h2>Links to Important Stuff</h2>
										<div>
											<div class="row">
												<div class="col-3 col-12-small">
													<ul class="link-list last-child">
														<li><a href="https://huggingface.co/du-kang/custom4">T-5 huggingface</a></li>
													</ul>
												</div>
												<div class="col-3 col-12-small">
													<ul class="link-list last-child">
														<li><a href="#">GEMMA huggingface</a></li>
													</ul>
												</div>
												<div class="col-3 col-12-small">
													<ul class="link-list last-child">
														<li><a href="#">Coming soon</a></li>
													</ul>
												</div>
												<div class="col-3 col-12-small">
													<ul class="link-list last-child">
														<li><a href="https://www.instagram.com/htk96/">instagram</a></li>
													</ul>
												</div>
											</div>
										</div>
									</section>

							</div>
							<div class="col-4 col-12-medium imp-medium">

								<!-- Blurb -->
									<section>
										<h2>News</h2>
										<p>
											The Gemma version of the summarization model is scheduled to be updated on April 25th. 
											We look forward to your anticipation.
										</p>
									</section>

							</div>
						</div>
					</div>
				</section>

			<!-- Copyright -->
				<div id="copyright">
					&copy; Untitled. All rights reserved. | Design: <a href="http://html5up.net">HTML5 UP</a>
				</div>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>